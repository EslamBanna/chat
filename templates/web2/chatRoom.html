<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="container">
        <aside>
            <header>
                <button id="createNewChatBtn">create new chat</button>
                <div id="creatNewChatRoomDiv">
                    <form action="">
                    <input type="text" name="creatNewChatRoomPhoneOrEmail" id="creatNewChatRoomPhoneOrEmail"
                        placeholder="Enter The number Phone Or Email" required />
                        <input type="submit" id="creatNewChatRoomAddBtn" value="Add" />
                        <p>Or Export Users File from Here <input type="file" name="Here" id="Here"></p>
                    </form>
                </div>
                <input type="text" placeholder="search" id="search">
            </header>
            <ul id="chatRooms">
            </ul>
        </aside>
        <main>
            <header>
                <img id="secondUserImage" alt="no chat">
                <div>
                    <h2 id="SecondUserName"></h2>
                    <h3 id="chatMessagesCount">already 1902 messages</h3>
                </div>
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1940306/ico_star.png" alt="">
            </header>
            <ul id="chat">
                <li class="you">
                    <div class="entete">
                        <span class="status green"></span>
                        <h2>Vincent</h2>
                        <h3>10:12AM, Today</h3>
                    </div>
                    <div class="triangle"></div>
                    <div class="message">
                        Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.
                    </div>
                </li>
                <li class="me">
                    <div class="entete">
                        <h3>10:12AM, Today</h3>
                        <h2>Vincent</h2>
                        <span class="status blue"></span>
                    </div>
                    <div class="triangle"></div>
                    <div class="message">
                        Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.
                    </div>
                </li>
                <li class="me">
                    <div class="entete">
                        <h3>10:12AM, Today</h3>
                        <h2>Vincent</h2>
                        <span class="status blue"></span>
                    </div>
                    <div class="triangle"></div>
                    <div class="message">
                        OK
                    </div>
                </li>
                <li class="you">
                    <div class="entete">
                        <span class="status green"></span>
                        <h2>Vincent</h2>
                        <h3>10:12AM, Today</h3>
                    </div>
                    <div class="triangle"></div>
                    <div class="message">
                        Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.
                    </div>
                </li>
                <li class="me">
                    <div class="entete">
                        <h3>10:12AM, Today</h3>
                        <h2>Vincent</h2>
                        <span class="status blue"></span>
                    </div>
                    <div class="triangle"></div>
                    <div class="message">
                        Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor.
                    </div>
                </li>
                <li class="me">
                    <div class="entete">
                        <h3>10:12AM, Today</h3>
                        <h2>Vincent</h2>
                        <span class="status blue"></span>
                    </div>
                    <div class="triangle"></div>
                    <div class="message">
                        OK
                    </div>
                </li>
            </ul>
            <footer>
                <textarea placeholder="Type your message"></textarea>
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1940306/ico_picture.png" alt="">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1940306/ico_file.png" alt="">
                <a href="#">Send</a>
            </footer>
        </main>
    </div>

    <script>
        var data;
        var user;
        window.onload = () => {
            console.log();
            var myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer 1|agiZowgjPsXTEKat75nwGXORNvxl83fcH6dSD8XL");

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };
            var test;
            fetch("http://127.0.0.1:8000/api/auth/get-chat-rooms", requestOptions)
                .then(response => response.text())
                .then(function result(x) {
                    data = JSON.parse(x);
                })
                .catch(error => console.log('error', error));

            fetch("http://127.0.0.1:8000/api/user", requestOptions)
                .then(response => response.text())
                .then(function result(x) {
                    user = JSON.parse(x);
                })
                .catch(error => console.log('error', error));
            setTimeout(showData, 1200);
        };

        function showData() {
            var chatRoom = "";
            if (data["status"] == false) {
                console.log("empty")
            } else {
                console.log("full")
                for (var i = 0; i < data["data"].length; i++) {
                    var lastUpdate = new Date(data["data"][i]['updated_at']);
                    if (data["data"][i]['second_user'] == null) {
                        chatRoom += `  <li onclick="openChat('${data["data"][i]['first_user']['name']}', '${data["data"][i]['first_user']['image']}')">
                    <img class="chatRoomImage" src="${data["data"][i]['first_user']['image']}" alt="">
                    <div>
                        <h2>${data["data"][i]['first_user']['name']}</h2>
                        <h3>
                            <span class="status orange"></span>
                            Last Update: ${lastUpdate.toDateString()}
                        </h3>
                    </div>
                </li>`;

                    } else {
                        chatRoom += `  <li onclick="openChat('${data["data"][i]['second_user']['name']}', '${data["data"][i]['second_user']['image']}')" >
                    <img class="chatRoomImage" src="${data["data"][i]['second_user']['image']}" alt="">
                    <div>
                        <h2>${data["data"][i]['second_user']['name']}</h2>
                        <h3>
                            <span class="status orange"></span>
                            Last Update: ${lastUpdate.toDateString()}
                        </h3>
                    </div>
                </li>`;

                    }
                }
            }
            var chatRooms = document.getElementById('chatRooms');
            chatRooms.innerHTML = chatRoom;

        }
        function openChat(userName, userImage) {
            SecondUserName.innerHTML = userName;
            document.getElementById('secondUserImage').setAttribute('src', userImage);
        }

        var createNewChatBtnBool = false;
        createNewChatBtn.onclick = function () {
            if (createNewChatBtnBool == false) {
                creatNewChatRoomDiv.style.height = '150px';
                creatNewChatRoomDiv.style.border = '1px solid white';
                creatNewChatRoomAddBtn.style.height = 'auto';
            } else {
                creatNewChatRoomDiv.style.height = '0px';
                creatNewChatRoomDiv.style.border = '0px';
                creatNewChatRoomAddBtn.style.height = '0px';
            }
            createNewChatBtnBool = !createNewChatBtnBool;
        } 
    </script>
</body>

</html>